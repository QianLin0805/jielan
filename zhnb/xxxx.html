<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<title>限行信息</title>
<link rel="stylesheet" href="css/map.css" type="text/css">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=itWnBCW7Ntd7ktXiwR9PB5TM"></script>
<script type="text/javascript" src="js/convertor.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	var pinggao=$(window).height();
	function buju(){
		$('ul').css({
			height:pinggao-112,
			top:-pinggao
		});
	}
	buju();
	navigator.geolocation.getCurrentPosition(myMap);              //GPS定位
	function myMap(position){
		var currentLat = position.coords.latitude;                //经度
		var currentLon = position.coords.longitude;               //纬度
		var gpsPoint = new BMap.Point(currentLon, currentLat);    //当前位置
		map = new BMap.Map("map");
		map.addControl(new BMap.NavigationControl());             //缩放控件
		map.addControl(new BMap.ScaleControl());                  //地图比例
		BMap.Convertor.translate(gpsPoint, 0, initMap);           //转换坐标
		//map.addControl(new BMap.OverviewMapControl());          //小地图
		//map.addControl(new BMap.MapTypeControl());              //右上角地图类型控件
		//map.enableScrollWheelZoom(true);                        //开启鼠标滚轮缩放
	}
	function initMap(point){
		map.centerAndZoom(point, 15);                             //初始化地图到当前位置并设置层级
		map.addOverlay(new BMap.Marker(point));                   //标记当前位置
		var points = [                                            //标注
			[120.20783,30.212233,'标记1','我的备注1'],
			[120.200715,30.207926,'标记2','我的备注2'],
			[120.210795,30.206223,'标记3','我的备注3']
		];
		for(var i=0; i<points.length; i++){
			(function(x){
				var point1 = points[x];
				var mark = new BMap.Point(point1[0], point1[1]);
				var myIcon = new BMap.Icon("images/map/mark.png",new BMap.Size(20, 24));
				var marker = new BMap.Marker(mark,{icon:myIcon});
				var opts = {
					width : 150,                                  //信息窗口宽度
					height: 60,                                   //信息窗口高度
					title : '标题：'+point1[2],                    //信息窗口标题
					enableAutoPan : true                          //自动平移
				}
				var infoWindow = new BMap.InfoWindow(point1[3], opts);
				marker.addEventListener("click", function(){ 
					map.openInfoWindow(infoWindow,mark);          //点击开启信息窗口
				});
				map.addOverlay(marker);                           //将标注添加到地图
			})(i);
		}
		//添加锁定当前位置控件
		var address;
		var geolocationControl=new BMap.GeolocationControl()
		geolocationControl.addEventListener("locationSuccess",function(e){
			console.log(address);
			address = '';
			//address += e.addressComponent.province;     //省
			//address += e.addressComponent.city;         //市
			address += e.addressComponent.district;       //区
			address += e.addressComponent.street;         //街道
			//address += e.addressComponent.streetNumber; //号
			//$('header p').children('b').text(address);
		});
		map.addControl(geolocationControl);
		//地图加载完毕事件
		map.addEventListener("tilesloaded",function(){
			//alert(address);
		});
	}
	$('header span img:eq(0),.search div img').bind('click',function(){
		$('header span').children().first().hide().next().show();
		$('ul').animate({top:0});
	});
	$('header span').children().eq(1).bind('click',function(){
		$(this).hide().prev().show();
		$('ul').animate({top:-pinggao});
	});
})
</script>
</head>
<body>
	<header>
    	<a href="index.html"><img src="images/arrow.png" alt="" class="left" /><h1>限行信息</h1></a>
        <p><img src="images/map/icon1.png" alt="" /><b>海曙区江夏桥西</b></p>
        <span>
        	<img src="images/map/icon2.png" alt="" class="maplist" />
        	<img src="images/map/icon3.png" alt="" class="map" style="display:none;" />
        </span>
    </header>
    <div class="search">
    	<select name="" id="">
        	<option value="">海曙区</option>
        	<option value="">江东区</option>
        	<option value="">镇海区</option>
        </select>
        <div>
        	<input type="text" />
            <img src="images/index/search1.png" alt="" />
        </div>
    </div>
    <ul>
    	<li><span>联丰路与丽园路</span><img src="images/map/traffic.png" alt="" /><b>1.5km</b></li>
    	<li><span>联丰路与丽园路</span><img src="images/map/traffic.png" alt="" /><b>1.5km</b></li>
    	<li><span>联丰路与丽园路</span><img src="images/map/traffic.png" alt="" /><b>1.5km</b></li>
    </ul>
	<div id="map"></div>
</body>
</html>